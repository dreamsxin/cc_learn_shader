{"version":3,"sources":["assets/shaderScene/MosaicEffectScene/MosaicEffectScene.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class MosaicEffectScene extends cc.Component {\n  private _xMosaicCountSlider: cc.Slider = null;\n  private _xMosaicCountSliderLabel: cc.Label = null;\n  private _yMosaicCountSlider: cc.Slider = null;\n  private _yMosaicCountSliderLabel: cc.Label = null;\n  private _mosaicCountSlider: cc.Slider = null;\n  private _mosaicCountSliderLabel: cc.Label = null;\n\n  private _examplesParentNode: cc.Node = null;\n\n  onLoad() {\n    // 关闭动态合图\n    cc.dynamicAtlasManager.enabled = false;\n\n    this._xMosaicCountSlider = cc\n      .find(\"Canvas/Content/Sliders/XMosaicCountSlider/Slider\")\n      .getComponent(cc.Slider);\n    this._xMosaicCountSliderLabel = cc\n      .find(\"Canvas/Content/Sliders/XMosaicCountSlider/ValueLabel\")\n      .getComponent(cc.Label);\n    this._yMosaicCountSlider = cc\n      .find(\"Canvas/Content/Sliders/YMosaicCountSlider/Slider\")\n      .getComponent(cc.Slider);\n    this._yMosaicCountSliderLabel = cc\n      .find(\"Canvas/Content/Sliders/YMosaicCountSlider/ValueLabel\")\n      .getComponent(cc.Label);\n    this._mosaicCountSlider = cc\n      .find(\"Canvas/Content/Sliders/MosaicCountSlider/Slider\")\n      .getComponent(cc.Slider);\n    this._mosaicCountSliderLabel = cc\n      .find(\"Canvas/Content/Sliders/MosaicCountSlider/ValueLabel\")\n      .getComponent(cc.Label);\n\n    this._examplesParentNode = cc.find(\"Canvas/Content/Examples\");\n  }\n\n  onEnable() {\n    this._xMosaicCountSlider.node.on(\"slide\", this._onSliderChanged, this);\n    this._yMosaicCountSlider.node.on(\"slide\", this._onSliderChanged, this);\n    this._mosaicCountSlider.node.on(\n      \"slide\",\n      this._onSliderChangedTogether,\n      this\n    );\n  }\n\n  onDisable() {\n    this._xMosaicCountSlider.node.off(\"slide\", this._onSliderChanged, this);\n    this._yMosaicCountSlider.node.off(\"slide\", this._onSliderChanged, this);\n    this._mosaicCountSlider.node.off(\n      \"slide\",\n      this._onSliderChangedTogether,\n      this\n    );\n  }\n\n  start() {\n    this._onSliderChanged();\n  }\n\n  private _onSliderChangedTogether() {\n    let mosaicCount = Math.round(this._mosaicCountSlider.progress * 300);\n    this._mosaicCountSliderLabel.string = `${mosaicCount}`;\n\n    // 更新材质\n    this._updateRenderComponentMaterial({\n      xBlockCount: mosaicCount,\n      yBlockCount: mosaicCount,\n    });\n  }\n\n  private _onSliderChanged() {\n    let xMosaicCount = Math.round(this._xMosaicCountSlider.progress * 300);\n    this._xMosaicCountSliderLabel.string = `${xMosaicCount}`;\n\n    let yMosaicCount = Math.round(this._yMosaicCountSlider.progress * 300);\n    this._yMosaicCountSliderLabel.string = `${yMosaicCount}`;\n\n    // 更新材质\n    this._updateRenderComponentMaterial({\n      xBlockCount: xMosaicCount,\n      yBlockCount: yMosaicCount,\n    });\n  }\n\n\n    /**\n     * 更新渲染组件的材质\n     *\n     * 1. 获取材质\n     * 2. 给材质的 unitform 变量赋值\n     * 3. 重新将材质赋值回去\n     */\n     private _updateRenderComponentMaterial(param: {\n        /**\n         * X轴方块数量 [1.0, 正无穷]\n         */\n        xBlockCount: number;\n\n        /**\n         * Y轴方块数量 [1.0, 正无穷]\n         */\n        yBlockCount: number;\n    }) {\n        this._examplesParentNode.children.forEach(childNode => {\n            childNode.getComponents(cc.RenderComponent).forEach(renderComponent => {\n                let material: cc.Material = renderComponent.getMaterial(0);\n                material.setProperty(\"xBlockCount\", param.xBlockCount);\n                material.setProperty(\"yBlockCount\", param.yBlockCount);\n                renderComponent.setMaterial(0, material);\n            });\n        });\n    }\n\n  // update (dt) {}\n}\n"]}